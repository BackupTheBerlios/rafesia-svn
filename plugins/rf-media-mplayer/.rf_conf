#!/bin/sh
rf_conf_info () {
	
	_RF_CONF_OPTIONS_NUM=2
	_RF_CONF_OPTIONS[0]="--enable-mplayer"
	_RF_CONF_OPTIONS_INFO[0]="Mplayer media module.  Default: "
	_RF_CONF_OPTIONS[1]="--disable-mplayer"
	_RF_CONF_OPTIONS_INFO[1]="Disabling Mplayer media module.  Default: "
	
	if cf_search_plugin "rf-media-mplayer"; then
		_RF_CONF_OPTIONS_INFO[0]="${_RF_CONF_OPTIONS_INFO[0]}Yes"
		_RF_CONF_OPTIONS_INFO[1]="${_RF_CONF_OPTIONS_INFO[1]}No"

	else
		_RF_CONF_OPTIONS_INFO[0]="${_RF_CONF_OPTIONS_INFO[0]}No"
		_RF_CONF_OPTIONS_INFO[1]="${_RF_CONF_OPTIONS_INFO[1]}Yes"
	fi
}

rf_conf_chopt () {
	
	case $1 in
		"--enable-mplayer") return 0;;
		"--disable-mplayer") return 0;;
		*) return 1;;
	esac
	
}

rf_conf_chdep () {
	
	case $1 in
		"--enable-mplayer") return 0;;
		"--disable-mplayer") return 0;;
	esac
}

rf_conf_mkopt () {
	
	case $1 in
		"--enable-mplayer") 
			cf_add_plugin "rf-media-mplayer"
			return 0;;
			
		"--disable-mplayer") 
			cf_rm_rcconf "$2"
			cf_rm_plugin "rf-media-mplayer"
			return 0;;
			
		*) return 1;;
	esac
	
}

rf_conf_enable_plugin () {
	
	cf_message "Checking for mplayer"
	if cf_command_exist "mplayer"; then
		cf_message " ... yes\n"
	else
		cf_message " ... no\n"
		return 1
	fi
	
	cf_add_rcconf /plugins/${1%/}/
	
	return 0
	
}

rf_conf_generate_makefile () {
	
	if [ -e $1/Makefile ]; then
		rm -rf $1/Makefile
	fi
	
	cf_add_to_makefile "$1" "# Rafesia generated Makefile\n\n"
	cf_add_to_makefile "$1"  "all:\n"
	
	cf_gcc_generate "CC" "rf-media-mplayer.o" "rf-media-mplayer.c" "\`pkg-config --cflags gtk+-2.0\` -fPIC -c" "(P) rf-media-mplayer | rf-media-mplayer.o"
	cf_add_to_makefile "$1"  "$_GCC_GENERATE_ECHO\n"
	cf_add_to_makefile "$1"  "$_GCC_GENERATE_RETURN\n"
	
	cf_gcc_generate "CC" "rf-media-module-funcs.o" "rf-media-module-funcs.c" "\`pkg-config --cflags gtk+-2.0\` -fPIC -c" "(P) rf-media-mplayer | rf-media-module-funcs.o"
	cf_add_to_makefile "$1"  "$_GCC_GENERATE_ECHO\n"
	cf_add_to_makefile "$1"  "$_GCC_GENERATE_RETURN\n"
	
	cf_gcc_generate "LN" "rf-media-mplayer.so" "rf-media-mplayer.o rf-media-module-funcs.o" "-shared -fPIC \`pkg-config --cflags --libs gtk+-2.0\`" "(P) rf-media-mplayer | rf-media-mplayer.so"
	cf_add_to_makefile "$1"  "$_GCC_GENERATE_ECHO\n"
	cf_add_to_makefile "$1"  "$_GCC_GENERATE_RETURN\n"
	
	cf_add_to_makefile "$1"  "\n\nclean:\n"
	cf_gcc_generate "RM" "rf-media-mplayer.o" "(P) rf-media-mplayer | rf-media-mplayer.o"
	cf_add_to_makefile "$1"  "$_GCC_GENERATE_ECHO\n"
	cf_add_to_makefile "$1"  "$_GCC_GENERATE_RETURN\n"
	cf_gcc_generate "RM" "rf-media-module-funcs.o" "(P) rf-media-mplayer | rf-media-module-funcs.o"
	cf_add_to_makefile "$1"  "$_GCC_GENERATE_ECHO\n"
	cf_add_to_makefile "$1"  "$_GCC_GENERATE_RETURN\n"
	cf_gcc_generate "RM" "rf-media-mplayer.so" "(P) rf-media-mplayer | rf-media-mplayer.so"
	cf_add_to_makefile "$1"  "$_GCC_GENERATE_ECHO\n"
	cf_add_to_makefile "$1"  "$_GCC_GENERATE_RETURN\n"
	cf_add_to_makefile "$1"  "\t@rm Makefile"

	cf_add_to_makefile "$1"  "\n\ninstall:\n"
	cf_add_to_makefile "$1"  "\t@cp ./rf-media-mplayer.so ${LIBDIR%/}/\n"
	
	return 0
	
}

rf_conf_unset () {
	unset rf_conf_info
		unset _RF_CONF_OPTIONS_NUM
		unset _RF_CONF_OPTIONS[0]
		unset _RF_CONF_OPTIONS_INFO[0]
		unset _RF_CONF_OPTIONS[1]
		unset _RF_CONF_OPTIONS_INFO[1]
	unset rf_conf_chopt
	unset rf_conf_chdep
	unset rf_conf_mkopt
	unset rf_conf_enable_plugin
	unset rf_conf_generate_makefile
	unset rf_conf_unset
}
